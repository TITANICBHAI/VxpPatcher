<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VXP Patcher</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }
        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input[type="text"]:focus,
        input[type="file"]:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .hint {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }
        button {
            width: 100%;
            padding: 14px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        button:active {
            background-color: #3d8b40;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .error {
            background-color: #f44336;
            color: white;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .success {
            background-color: #4CAF50;
            color: white;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .no-js .loading {
            display: none !important;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .info {
            background-color: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-top: 30px;
            font-size: 13px;
            color: #333;
        }
        .info h3 {
            color: #1976D2;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info p {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        .info code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            color: #333;
        }
        .warning strong {
            color: #f57c00;
        }
        .method {
            background-color: #f9f9f9;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .method-title {
            font-weight: bold;
            color: #1976D2;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>VXP Patcher</h1>
        <p class="subtitle">Patch VXP files for MRE phones (Nokia 5310, 225, etc.)</p>
        
        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}
        
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Processing your VXP file... Please wait.</p>
        </div>
        
        <form method="POST" action="/patch" enctype="multipart/form-data" id="patchForm">
            <div class="form-group">
                <label for="imsi">IMSI Number:</label>
                <input type="text" id="imsi" name="imsi" maxlength="15" pattern="[0-9]{15}" required placeholder="Enter 15-digit IMSI">
                <p class="hint">Your SIM card's IMSI number (15 digits)</p>
            </div>
            
            <div class="form-group">
                <label for="vxp_file">VXP File:</label>
                <input type="file" id="vxp_file" name="vxp_file" accept=".vxp" required>
                <p class="hint">Select the .vxp file to patch</p>
            </div>
            
            <button type="submit">Patch!</button>
        </form>
        
        <div class="warning">
            <p><strong>Privacy Warning:</strong> Your IMSI is a unique identifier tied to your SIM card. Never share it with untrusted parties as it can be used to track your location or identity. This tool processes files locally and does not store your IMSI.</p>
        </div>
        
        <div class="info">
            <h3>How to find your IMSI number:</h3>
            
            <div class="method">
                <div class="method-title">Method 1: Android Phone Settings</div>
                <p>1. Insert SIM into Android phone</p>
                <p>2. Go to: Settings → About phone → Status → IMSI</p>
                <p>3. Copy the 15-digit number</p>
            </div>
            
            <div class="method">
                <div class="method-title">Method 2: Using ADB (Android Debug Bridge)</div>
                <p>Connect phone to computer and run:</p>
                <p><code>adb shell service call iphonesubinfo 1</code></p>
                <p>Then extract the 15-digit IMSI from the output</p>
            </div>
            
            <div class="method">
                <div class="method-title">Method 3: Dial Code (Some Devices)</div>
                <p>Try dialing: <code>*#06#</code> or <code>*#*#4636#*#*</code></p>
                <p>Look for "IMSI" in the device info (not all phones support this)</p>
            </div>
            
            <div class="method">
                <div class="method-title">Method 4: SIM Card Reader Apps</div>
                <p>Install a SIM info app from Google Play Store</p>
                <p>Examples: "SIM Card Info" or "Phone and SIM Info"</p>
            </div>
            
            <p style="margin-top: 15px;"><strong>Note:</strong> The patched VXP will only work on phones using the SIM card with this IMSI number. Browsers cannot automatically read IMSI for security reasons.</p>
        </div>
    </div>
    
    <script>
        (function() {
            var form = document.getElementById('patchForm');
            if (form) {
                var loadingIndicator = document.getElementById('loadingIndicator');
                var submitButton = form.querySelector('button[type="submit"]');
                var fileInput = document.getElementById('vxp_file');
                var imsiInput = document.getElementById('imsi');
                
                if (fileInput.addEventListener) {
                    fileInput.addEventListener('change', function() {
                        var maxSize = 16 * 1024 * 1024;
                        if (this.files && this.files[0] && this.files[0].size > maxSize) {
                            alert('File is too large! Maximum size is 16MB.');
                            this.value = '';
                        }
                    });
                }
                
                if (imsiInput.addEventListener) {
                    imsiInput.addEventListener('input', function() {
                        this.value = this.value.replace(/[^0-9]/g, '');
                        if (this.value.length > 15) {
                            this.value = this.value.slice(0, 15);
                        }
                    });
                }
                
                if (form.addEventListener) {
                    form.addEventListener('submit', function(e) {
                        if (imsiInput.value.length !== 15) {
                            e.preventDefault();
                            alert('IMSI must be exactly 15 digits!');
                            return false;
                        }
                        
                        if (fileInput.files && !fileInput.files[0]) {
                            e.preventDefault();
                            alert('Please select a VXP file!');
                            return false;
                        }
                        
                        if (loadingIndicator) {
                            loadingIndicator.style.display = 'block';
                        }
                        if (submitButton) {
                            submitButton.disabled = true;
                            submitButton.textContent = 'Processing...';
                        }
                        
                        setTimeout(function() {
                            if (loadingIndicator) {
                                loadingIndicator.style.display = 'none';
                            }
                            if (submitButton) {
                                submitButton.disabled = false;
                                submitButton.textContent = 'Patch!';
                            }
                            form.reset();
                        }, 2000);
                    });
                }
            }
        })();
    </script>
</body>
</html>
